#### Installation ####
# File: .zshrc or .bashrc or ...
# Add:  source ~/.my_profile
# Done...

### Determine OS being used ###

MY_OS=$(uname)
case $MY_OS in
  'Linux')
    MY_OS='linux'
    ;;
  'WindowsNT')
    MY_OS='dos'
    ;;
  'Darwin')
    MY_OS='darwin'
    ;;
  *) ;;
esac

### Determine ARCH being used ###

MY_ARCH=$(uname -m)
case $MY_ARCH in
  x86_64)
    MY_ARCH=x64  # or AMD64 or Intel64 or whatever
    ;;
  i*86)
    MY_ARCH=x86  # or IA32 or Intel32 or whatever
    ;;
  *)
    ;;
esac

### Determine DISTRO being used ###

# by type
MY_DISTRO=$(uname)
case $MY_DISTRO in
  Linux )
    # test for distro by command
    MY_DISTRO=$(cat /proc/version)
    if [[ "$MY_DISTRO" == *"Ubuntu"* ]]; then
      MY_DISTRO=debian
    elif [[ "$MY_DISTRO" == *"Red Hat"* ]]; then
      MY_DISTRO=rhel
    fi
    ;;
  Darwin )
     MY_DISTRO=darwin
     ;;
  * )
     ;;
esac
 
### Determine SHELL being used ###

MY_SHELL=$(echo $0)
#MY_SHELL=$SHELL
if [[ $MY_SHELL == *zsh* ]]; then
  #!/bin/zsh
  MY_SHELL=zsh
elif [[ $MY_SHELL == *bash* ]]; then
  #!/bin/bash
  MY_SHELL=bash
fi

### Determine TERM being used ###

MY_TERM=$TERM
if [[ $MY_TERM == *xterm* ]]; then
  MY_TERM=xterm
fi

# Display env. in terminal
if [ -n $1 ] && [[ $1 == -v ]]; then
  echo "$MY_OS $MY_DISTRO $MY_ARCH $MY_TERM $MY_SHELL"
  echo ""
fi

### Terminal History ###

# Saving HISTFILESIZE lines to disk and loading the last HISTSIZE lines into memory
HISTSIZE=5000
HISTFILESIZE=10000
# Append history from each session, not the last terminal to log out
if [[ $MY_SHELL == bash ]]; then
  shopt -s histappend > /dev/null 2>&1
elif [[ $MY_SHELL == zsh ]]; then
  setopt INC_APPEND_HISTORY > /dev/null 2>&1
fi
# Add commands immediatley to history, not wait for log out
export PROMPT_COMMAND="history -a; history -c; history -r; $PROMPT_COMMAND"

### Variables ###

export SUCCESS=0
export FAIL=1
# editor default
export EDITOR='vim'

### Aliases ###
if type htop > /dev/null 2>&1; then
  alias top='htop'
fi
alias vi='vim'
# not the real God, hence lowercase.
alias god='sudo'
alias please='god'
alias c='clear'
alias h='history'
alias quit='exit'
alias q='quit'
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias mkdir='mkdir -pv'
if [[ $MY_OS == darwin ]]; then
  alias df='df -ha'
else
  alias df='df -Tha'
fi
alias du='du -ach'
alias free='free -mt'
alias here='find . ! -perm -g+r,u+r,o+r -prune -name'
alias herein='grep -rnl . -e'
alias whereami='uname -a'
alias echor='>&2 echo'
# w/ millisecond
alias now='date +"%m-%d-%Y %T.%3N"'
## safety
alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'
alias reboot='sudo shutdown -r now'
alias shutdown='sudo shutdown now'
alias plogout='sudo pkill -KILL -u'
# search
alias psf='ps | grep -v grep | grep -i -e VSZ -e'
if [[ $MY_OS == darwin ]]; then
  alias ls='ls -GpF'
else
  alias ls='ls -pF --color=auto'
fi
alias which='/usr/bin/which --all --tty-only --read-alias --read-functions --show-tilde --show-dot'
alias l='ls'
alias ll='ls -lAh'
alias l.='ls -d .*'
alias la='ls -lah'
if [[ $MY_OS == darwin ]]; then
  # gnu util for darwin
  alias timeout='gtimeout'
  alias ps='ps aux'
else 
  alias ps='ps auxf'
fi
if [[ $MY_DISTRO == debian ]]; then
  alias apt-get='sudo apt-get -y'
  alias upgrade='apt-get update && apt-get dist-upgrade && apt-get upgrade && apt-get autoclean && apt-get autoremove && gem update && gem cleanup'
fi
if [[ $MY_DISTRO == darwin ]]; then
  alias upgrade='brew update && brew upgrade && brew cleanup && brew cask cleanup && gem update && sudo sh -c 'GEM_HOME=/System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/gems/2.0.0 gem cleanup' && mas upgrade'
fi
# replace awk with ag if found
if type ag > /dev/null 2>&1; then
  alias awk='ag'
fi
if type autojump > /dev/null 2>&1; then
  alias j='autojump'
fi
# Port forwarding thru SSH
#alias torified="ssh -D 127.0.0.1:1080 -L 3128:127.0.0.1:3128 -L 8123:127.0.0.1:8123 -L 8118:127.0.0.1:8118 -L 9050:127.0.0.1:9050 <username>@<ip> -p <port>"

### Functions ###

# like dos
pause(){
  read -rsp $'Press any key to continue...\n' -n 1 key
}

# list after each cd
cd() {
  if [ -n "$1" ]; then
    builtin cd "$@" && ls
  else
    builtin cd ~ && ls
  fi
}

# history info "-i [depth]" added
history() {
  if [ -n "$1" ] && [[ "$1" == "-i" ]]; then
    local _depth=10
    if [ -n "$2" ]; then
      local _depth=$2
    fi
    builtin history | awk '{CMD[$2]++;count++;}END { for (a in CMD)print CMD[a] " " CMD[a]/count*100 "% " a;}' | grep -v "./" | column -c3 -s " " -t | sort -nr | nl |  head -n$_depth
  else
    builtin history "$@"
  fi
}

screen() {
  if [ -z "$1" ]; then
    command screen -DR default
  else
    command screen "$@"
  fi
}

mux()
{
  if [ -n "$1" ] && [[ "$1" == "-k" ]]; then
    if [ -n "$2" ]; then
      command tmux kill-session -t $2
    else
      command tmux kill-session
    fi
  elsef
    command mux "$@"
  fi
}

# kill vnc window(s)
vncserver()
{
  if [ -n "$1" ] && [[ "$1" == "-kill" ]] && [ -n "$2" ] && [[ "$2" == ":-1" ]]; then
    for v in ~/.vnc/*.pid
    do
      local _window=$(basename "$v" .pid)
      command vncserver -kill $_window
    done
  else
    command vncserver "$@"
  fi
}

# make space in terminal for scrolling
s() {
  space
}

space() {
  for i in {1..50}
  do
   echo ""
  done
  clear
}

# terminal screen saver (matrix)
if type cmatrix > /dev/null 2>&1; then
  tss() {
    cmatrix
    clear
  }
fi

### Key Bindings ###

if [[ $MY_TERM == xterm ]]; then
  # backspace work instead of delete ^H
  stty erase '^?'
fi

# bind keys per shell and terminal
if [[ $MY_SHELL == zsh ]]; then
  # home and end keys
  bindkey '\e[1~' beginning-of-line
  bindkey '\e[4~' end-of-line  
fi

### Other ###

if [[ $MY_OS == darwin ]]; then
  if type archey > /dev/null 2>&1; then
    archey
  fi

  alias afplay='afplay -q 1'.

  # For fun...
  # play funny sounds from terminal
  source ~/.sounds/.sound > /dev/null 2>&1
fi
